<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Professional CV Maker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f4f6f8; }
    h1 { text-align:center; margin-top:20px; }
    .profile-img { width:100px; height:100px; border-radius:50%; object-fit:cover; margin-bottom:10px; }
    .cv-card { padding:20px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); background:#fff; }
    .template-classic { font-family: Arial; }
    .template-modern { font-family:'Segoe UI'; background:#0f172a; color:#fff; }
    .template-modern h2,h3 { color:#38bdf8; }
    @media(max-width:768px){ .row-cols-1 .col { margin-bottom:20px; } }
  </style>
</head>
<body>
  <h1>Professional CV Maker</h1>

  <div class="container" id="auth-page">
    <div class="row row-cols-1 justify-content-center">
      <div class="col-md-4">
        <div class="cv-card text-center">
          <h2>Signup / Login</h2>
          <input class="form-control my-2" id="auth-email" placeholder="Email" />
          <input class="form-control my-2" id="auth-password" type="password" placeholder="Password" />
          <button class="btn btn-primary w-100 my-1" onclick="signup()">Signup</button>
          <button class="btn btn-success w-100 my-1" onclick="login()">Login</button>
          <button onclick="googleLogin()">Login with Google</button>
          <script type="module" src="firebase.js"></script>
          <p id="auth-msg"></p>
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="cv-page" style="display:none;">
    <div class="d-flex justify-content-end my-2">
      <button class="btn btn-danger" id="logoutBtn" onclick="logout()">Logout</button>
    </div>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      <div class="col">
        <div class="cv-card">
          <h2>Enter Your Information</h2>
          <input class="form-control my-2" id="name" placeholder="Full Name" />
          <input class="form-control my-2" id="emailInput" placeholder="Email" />
          <input class="form-control my-2" id="phone" placeholder="Phone" />
          <label>Profile Photo</label>
          <input class="form-control mb-2" type="file" accept="image/*" onchange="loadPhoto(event)" />

          <label>Choose CV Template</label>
          <select class="form-select mb-2" id="template" onchange="changeTemplate()">
            <option value="template-classic">Classic</option>
            <option value="template-modern">Modern</option>
          </select>

          <h4>Education</h4>
          <input class="form-control my-1" id="degree" placeholder="Degree" />
          <input class="form-control my-1" id="institution" placeholder="Institution" />
          <input class="form-control my-1" id="year" placeholder="Year" />
          <button class="btn btn-info my-1" onclick="addEducation()">Add Education</button>
          <ul id="edu-list"></ul>

          <h4>Skills</h4>
          <textarea class="form-control" id="skills" rows="3"></textarea>
          <h4>Experience</h4>
          <textarea class="form-control" id="experience" rows="3"></textarea>

          <button class="btn btn-primary my-2" onclick="generateCV()">Generate CV</button>
          <button class="btn btn-success my-2" onclick="saveCV(auth.currentUser.uid)">Save CV</button>
          <button class="btn btn-warning my-2" onclick="downloadPDF()">Download PDF</button>
        </div>
      </div>

      <div class="col">
        <div class="cv-card" id="cv" class="template-classic text-dark">
          <img id="cv-photo" class="profile-img" />
          <h2 id="cv-name">Your Name</h2>
          <p id="cv-email">Email</p>
          <p id="cv-phone">Phone</p>
          <hr />
          <h3>Education</h3>
          <ul id="cv-education"></ul>
          <h3>Skills</h3>
          <p id="cv-skills"></p>
          <h3>Experience</h3>
          <p id="cv-experience"></p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let educations = [];

    auth.onAuthStateChanged(user => {
      if(user){
        document.getElementById('auth-page').style.display='none';
        document.getElementById('cv-page').style.display='block';
        document.getElementById('logoutBtn').style.display='inline-block';
        loadSavedCVs(user.uid);
      } else {
        document.getElementById('auth-page').style.display='block';
        document.getElementById('cv-page').style.display='none';
        document.getElementById('logoutBtn').style.display='none';
      }
    });

    function signup(){
      auth.createUserWithEmailAndPassword(authEmail.value, authPassword.value)
        .then(()=>{authMsg.innerText='Signup successful. Please login.'})
        .catch(e=>authMsg.innerText=e.message);
    }

    function login(){
      auth.signInWithEmailAndPassword(authEmail.value, authPassword.value)
        .catch(e=>authMsg.innerText=e.message);
    }

    function googleLogin(){
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .catch(error => { authMsg.innerText = error.message; });
    }

    function logout(){ auth.signOut(); location.reload(); }

    function addEducation(){
      const deg=degree.value, inst=institution.value, yr=year.value;
      if(!deg||!inst||!yr) return;
      educations.push({deg,inst,yr}); renderEducation();
      degree.value=institution.value=year.value='';
    }

    function renderEducation(){
      eduList.innerHTML=''; cvEducation.innerHTML='';
      educations.forEach(e=>{
        const li=document.createElement('li'); li.innerText=`${e.deg} - ${e.inst} (${e.yr})`;
        eduList.appendChild(li); cvEducation.appendChild(li.cloneNode(true));
      });
    }

    function generateCV(){
      cvName.innerText=name.value||'Your Name';
      cvEmail.innerText=emailInput.value;
      cvPhone.innerText=phone.value;
      cvSkills.innerText=skills.value;
      cvExperience.innerText=experience.value;
    }

    function saveCV(uid){
      const data={name:name.value,email:emailInput.value,phone:phone.value,education:educations,skills:skills.value,experience:experience.value,template:template.value,timestamp:Date.now()};
      db.collection('users').doc(uid).collection('cvs').add(data)
        .then(()=> alert('CV saved to cloud!'))
        .catch(err=>console.log(err));
    }

    function loadSavedCVs(uid){
      db.collection('users').doc(uid).collection('cvs').orderBy('timestamp','desc').limit(1).get()
        .then(snapshot => {
          if(snapshot.empty) return;
          const last = snapshot.docs[0].data();
          name.value = last.name;
          emailInput.value = last.email;
          phone.value = last.phone;
          educations = last.education || [];
          renderEducation();
          skills.value = last.skills;
          experience.value = last.experience;
          template.value = last.template;
          changeTemplate();
          generateCV();
        });
    }

    function changeTemplate(){ cv.className='cv-card '+template.value; }
    function loadPhoto(event){ cvPhoto.src=URL.createObjectURL(event.target.files[0]); }

    function downloadPDF(){
      const { jsPDF } = window.jspdf; const doc=new jsPDF();
      doc.setFontSize(18); doc.text(cvName.innerText,10,20);
      doc.setFontSize(12); doc.text(cvEmail.innerText,10,30); doc.text(cvPhone.innerText,10,38);
      doc.text('Education:',10,50);
      educations.forEach((e,i)=>{doc.text(`${e.deg} - ${e.inst} (${e.yr})`,10,58+i*8)});
      doc.text('Skills:',10,90); doc.text(cvSkills.innerText,10,98);
      doc.text('Experience:',10,110); doc.text(cvExperience.innerText,10,118);
      doc.save('My_CV.pdf');
    }
  </script>
</body>
</html>



